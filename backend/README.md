# kSar Web Backend

This is the backend for the kSar Web application, a Python FastAPI-based web service for parsing and analyzing SAR (System Activity Reporter) files.

## Features

- **SAR File Parsing**: Support for Linux SAR files (AIX, HPUX, Solaris support planned)
- **RESTful API**: FastAPI-based web API with automatic documentation
- **File Upload**: Upload and parse SAR files via HTTP
- **Data Extraction**: Extract time series data from SAR files
- **System Information**: Extract system information from SAR headers

## Installation

1. **Clone the repository**:
   ```bash
   git clone <repository-url>
   cd ksar/backend
   ```

2. **Create a virtual environment**:
   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

3. **Install dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

## Usage

### Running the Application

1. **Start the development server**:
   ```bash
   uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
   ```

2. **Access the API documentation**:
   - Open your browser and go to `http://localhost:8000/docs`
   - This will show the interactive API documentation

### API Endpoints

- `GET /` - Root endpoint
- `GET /health` - Health check
- `POST /api/upload` - Upload and parse a SAR file
- `GET /api/files` - List all parsed files
- `GET /api/files/{file_id}` - Get file information
- `DELETE /api/files/{file_id}` - Delete a parsed file
- `POST /api/parse/{file_id}` - Parse a file
- `GET /api/parse/{file_id}/status` - Get parsing status
- `GET /api/parse/{file_id}/data` - Get parsed data

### Testing

1. **Run the test script**:
   ```bash
   python test_parser.py
   ```

2. **Run unit tests**:
   ```bash
   pytest tests/
   ```

## Project Structure

```
backend/
├── app/
│   ├── main.py                 # FastAPI application
│   ├── api/                    # API endpoints (future)
│   ├── core/                   # Core configuration
│   ├── parsers/                # SAR file parsers
│   │   ├── __init__.py
│   │   ├── base.py             # Base parser class
│   │   └── linux.py            # Linux SAR parser
│   ├── models/                 # Data models
│   ├── services/               # Business logic services
│   │   ├── __init__.py
│   │   └── parser_service.py   # Parser service
│   └── utils/                  # Utility functions
├── tests/                      # Test files
├── requirements.txt            # Python dependencies
└── README.md                   # This file
```

## Parser Architecture

The parser system is designed to be extensible and supports multiple operating system formats:

### Base Parser (`base.py`)
- Abstract base class for all parsers
- Common functionality for date/time parsing
- System information extraction
- Time series data structures

### Linux Parser (`linux.py`)
- Parses Linux SAR files generated by sysstat
- Supports CPU, memory, disk, network, and load statistics
- Automatic date/time format detection
- Handles various Linux SAR output formats

### Parser Service (`parser_service.py`)
- Orchestrates file parsing
- Manages parsed data storage
- Provides high-level API for parsing operations

## Data Models

### SystemInfo
- OS type, hostname, kernel version
- CPU count, memory information
- System configuration details

### TimeSeriesData
- Metric name and columns
- Timestamps and values
- Metadata for additional information

### ParsedData
- File ID and system information
- Time range (start/end times)
- Dictionary of metrics
- Set of date samples

## Development

### Adding New Parsers

1. Create a new parser class that inherits from `BaseParser`
2. Implement the required abstract methods:
   - `parse_header()`: Parse the header line
   - `parse_line()`: Parse individual data lines
3. Add the parser to the `ParserService` class
4. Add tests for the new parser

### Example Parser Structure

```python
class NewOSParser(BaseParser):
    def __init__(self):
        super().__init__()
        self.parser_name = "NewOS"
        self.system_info.os_type = "NewOS"
    
    def parse_header(self, header_line: str) -> None:
        # Parse header logic
        pass
    
    def parse_line(self, line: str, columns: List[str]) -> int:
        # Parse data line logic
        pass
```

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests for new functionality
5. Submit a pull request

## License

This project is licensed under the same license as the original kSar project. 